!function(t) {
    // üîê –ü–æ–ª–∏—Ñ–∏–ª–ª –¥–ª—è crypto.randomUUID (–¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤)
    if (!t.crypto?.randomUUID) {
        t.crypto.randomUUID = function () {
            return "tk-form" + Math.floor(1e5 + 9e5 * Math.random());
        };
    }

    let e = ".custom-form",
        r = ".custom-form-submit",
        o = (t = {}) => {
            e = t.formClass || e, r = t.customSubmitClass || r;
            t_onReady(() => {
                t_onFuncLoad("t_zeroForms__onReady", () => {
                    n();
                });
            });

            // üîÑ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–æ–ø–∞–ø–∞
            document.addEventListener("tilda-popup-open", function () {
                setTimeout(() => {
                    if (window.tkForm && typeof window.tkForm.init === "function") {
                        tkForm.init({
                            formClass: e,
                            customSubmitClass: r,
                        });
                    }
                }, 100);
            });
        },
        n = () => {
            let t = document.querySelectorAll(e);
            if (0 === t.length) {
                console.error("[TKFORM] –ù–µ –Ω–∞–π–¥–µ–Ω–æ –Ω–∏ –æ–¥–Ω–æ–π —Ñ–æ—Ä–º—ã —Å –∫–ª–∞—Å—Å–æ–º", e);
                return;
            }
            let r = new Set;
            if (t.forEach(t => {
                    let e = t.closest(".t-rec");
                    e && r.add(e);
                }), 0 === r.length) {
                console.error("[TKFORM] –ù–µ –Ω–∞–π–¥–µ–Ω–æ –Ω–∏ –æ–¥–Ω–æ–≥–æ –∑–µ—Ä–æ –±–ª–æ–∫–∞ —Å —Ñ–æ—Ä–º–∞–º–∏");
                return;
            }
            i(t), s(r), a(t);
        },
        i = t => {
            t.forEach(t => t.querySelector(".tn-form__submit")?.remove());
        },
        a = t => {
            t.forEach(t => {
                Array.prototype.slice.call(t.querySelectorAll(".t-input:not(.t-inputquantity):not(.t-input-phonemask__wrap):not(.t-input-phonemask):not(.t-input__own-answer)")).forEach(function(e) {
                    e.addEventListener("blur", function(t) {
                        t.target.value ? t.target.classList.add("t-input_has-content") : t.target.classList.remove("t-input_has-content");
                    });
                });
            });
        },
        s = t => {
            t.forEach(t => {
                let o = t.querySelector(".t396__artboard"),
                    n = t.querySelectorAll(e),
                    i = t.querySelector(r);
                if (!o) return console.error("[TKFORM] –ù–µ –Ω–∞–π–¥–µ–Ω —ç–ª–µ–º–µ–Ω—Ç t396__artboard –≤ –±–ª–æ–∫–µ:", t), !1;
                if (0 === n.length) return console.error(`[TKFORM] –ù–µ –Ω–∞–π–¥–µ–Ω–æ –Ω–∏ –æ–¥–Ω–æ–π —Ñ–æ—Ä–º—ã —Å –∫–ª–∞—Å—Å–æ–º ${e} –≤ –±–ª–æ–∫–µ`, t), !1;
                if (!i) return console.error(`[TKFORM] –ù–µ –Ω–∞–π–¥–µ–Ω–æ –∫–Ω–æ–ø–∫–∏ submit —Å –∫–ª–∞—Å—Å–æ–º ${r} –≤ –±–ª–æ–∫–µ`, t), !1;

                let a = o.dataset.artboardRecid ? "tk-form" + o.dataset.artboardRecid : "tk-form" + Math.floor(1e5 + 9e5 * Math.random()),
                    s = document.createElement("div");
                s.innerHTML = `<form class="t-form t-form_inputs-total_2 js-form-proccess" id="${a}" name="form778879734" action="https://forms.tildacdn.com/procces/ " method="POST" role="form" data-formactiontype="2" data-inputbox=".t-input-group" data-success-callback="t396_onSuccess" data-success-popup="y" data-error-popup="y"></form>`;
                let u = s.childNodes[0];
                n.forEach(t => {
                    let e = t.querySelector("form");
                    if (!e) return console.error("[TKFORM] –ù–µ –Ω–∞–π–¥–µ–Ω–æ —Ñ–æ—Ä–º—ã –≤ —ç–ª–µ–º–µ–Ω—Ç–µ", t), !1;
                    let r = document.createElement("div");
                    [...e.attributes].forEach(t => r.setAttribute(t.name, t.value));
                    r.append(...e.cloneNode(!0).childNodes);
                    e.replaceWith(r);
                    u.appendChild(t);
                });
                u.appendChild(i);
                o.appendChild(u);
                l(u, i);
            });
        },
        l = (t, e) => {
            if (!t) return console.error("[TKFORM] –ù–µ –Ω–∞–π–¥–µ–Ω–æ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ñ–æ—Ä–º—ã, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É: bystricky@tonky-kot.ru"), !1;
            if (!e) return console.error(`[TKFORM] –ù–µ –Ω–∞–π–¥–µ–Ω–æ –∫–Ω–æ–ø–∫–∏ submit –≤ —Ñ–æ—Ä–º–µ`, t), !1;

            e.setAttribute("type", "submit");
            e.setAttribute("tabindex", "0");
            e.setAttribute("onKeyDown", "tkForm.handleSubmitKeyDown(event)");
            let r = e.getAttribute("style");
            e.setAttribute("style", r + " cursor: pointer;");

            e.addEventListener("click", function handleClick(e) {
                e.preventDefault();
                e.stopPropagation();

                window.tildaForm.hideErrors(t);
                let errors = window.tildaForm.validate(t);

                if (errors.length) {
                    window.tildaForm.showErrors(t, errors);
                    return;
                }

                // ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —É—Å–ø–µ—Ö –¢–∏–ª—å–¥—ã
                if (typeof t396_onSuccess === 'function') {
                    const recid = t.closest('.t-rec')?.dataset['recordId'] || '';
                    t396_onSuccess({ form: t, recid });
                }

                // üïí –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ–ø–∞–ø —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    const popup = document.querySelector('.t-popup_opened');
                    if (popup && typeof t_onPopupClose === 'function') {
                        t_onPopupClose(popup);
                    }
                }, 3000);
            });

            e.classList.add("t-submit");

            t_onReady(function () {
                setTimeout(function () {
                    if (window.t_upwidget__init) {
                        t_zeroForms__onFuncLoad("t_upwidget__init", () => e.classList.remove("t-submit"));
                    } else {
                        e.classList.remove("t-submit");
                    }
                }, 500);
            });
        };

    t.tkForm = {
        init: o,
        handleSubmitKeyDown: function t(e) {
            (13 === e.keyCode || 32 === e.keyCode) && (e.preventDefault(), e.target.dispatchEvent(new Event("click")));
        }
    };
}(window);
